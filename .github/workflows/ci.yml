name: CI

on:
  push:
    branches: [main, master]
    paths-ignore:
      # AI assistant / IDE configuration - not part of built app
      - '.claude/**'
      - '.cursor/**'
      # GitHub workflows/config - don't affect built app
      - '.github/**'
      # Developer documentation - not bundled in app
      - 'CONTRIBUTING.md'
      - 'LICENSE'
      - '.gitignore'
      # Note: Docs/Help/** IS bundled in app, so changes there SHOULD trigger CI
      # Note: VERSION IS displayed in app, so changes there SHOULD trigger CI
  pull_request:
    branches: [main, master]
    paths-ignore:
      - '.claude/**'
      - '.cursor/**'
      - '.github/**'
      - 'CONTRIBUTING.md'
      - 'LICENSE'
      - '.gitignore'
  workflow_dispatch:

jobs:
  build:
    name: Build
    runs-on: macos-15

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode_16.4.app/Contents/Developer

      - name: Show Swift version
        run: swift --version

      - name: Copy Help Resources
        run: make copy-help

      - name: Build
        run: swift build

  test:
    name: Test
    runs-on: macos-15

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode_16.4.app/Contents/Developer

      - name: Copy Help Resources
        run: make copy-help

      - name: Run tests
        run: swift test

  lint:
    name: Lint
    runs-on: macos-15

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Install SwiftLint
        run: brew install swiftlint

      - name: Run SwiftLint
        run: swiftlint lint --config .swiftlint.yml --reporter github-actions-logging

  format:
    name: Format Check
    runs-on: macos-15

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Install swift-format
        run: brew install swift-format

      - name: Check formatting
        run: swift-format lint --configuration .swift-format --recursive Sources/ Tests/

  build-release:
    name: Build Release
    runs-on: macos-15
    needs: [build, test, lint, format]

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode_16.4.app/Contents/Developer

      - name: Copy Help Resources
        run: make copy-help

      - name: Build release
        run: swift build -c release
      # Note: Full packaging (app bundle, signing, DMG) happens in release.yml
      # This job just validates the release build compiles successfully
